![test](https://github.com/davips/hdict/workflows/test/badge.svg)
[![codecov](https://codecov.io/gh/davips/hdict/branch/main/graph/badge.svg)](https://codecov.io/gh/davips/hdict)
<a href="https://pypi.org/project/hdict">
<img src="https://img.shields.io/pypi/v/hdict.svg?label=release&color=blue&style=flat-square" alt="pypi">
</a>
![Python version](https://img.shields.io/badge/python-3.10...-blue.svg)
[![license: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

<!--- [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.5501845.svg)](https://doi.org/10.5281/zenodo.5501845) --->
[![arXiv](https://img.shields.io/badge/arXiv-2109.06028-b31b1b.svg?style=flat-square)](https://arxiv.org/abs/2109.06028)
[![API documentation](https://img.shields.io/badge/API-autogenerated-a030a0.svg)](https://davips.github.io/hdict)
[![Manual](https://img.shields.io/badge/manual-handcrafted-a030a0.svg)](https://hosh.page)

# hdict { A _unique_ data structure }
[Website](https://hosh.page) | 
[Latest Release](https://pypi.org/project/hdict) |
[Current Code](https://github.com/davips/hdict) |
[API Documentation](https://davips.github.io/hdict)

Please see the [website](https://hosh.page) for more detailed usage information.

## Overview
**Shortly**: A data structure based on a novel identification paradigm useful for frictionless computing, experiments, distributed data, among others.

**Formally**: Hosh-based cacheable lazy dict with predictable/deterministic universally (probabilistically guaranteed) unique identifiers.


### See also

  * [hosh](https://pypi.org/project/hosh): identification engine at the core of `hdict`
  * previous projects: [hoshmap](https://pypi.org/project/hoshmap), [idict](https://pypi.org/project/idict), [ldict](https://pypi.org/project/ldict), [garoupa](https://pypi.org/project/garoupa)

### The concept

`hdict` is like an ordinary `dict` with `str` keys. 
Each entry and the `hdict` itself are identified by 40-digit hashes.
<<simple>>



An `hdict` is like a common Python `dict`, with extra functionality and lazy.
It is a mapping between string keys, called
fields, and any serializable (pickable) object.
Each `hdict` has two extra entries: `id` (identifier) and `ids` (value identifiers).

A custom 40-digit unique identifier (see [GaROUPa](https://pypi.org/project/garoupa))
can be provided as an attribute for each function.
Value objects can have custom identifiers as well, if provided whithin the entry `ids`.

Otherwise, identifiers for functions and values will be calculated through blake3 hashing of their content.
For functions, the bytecode is used as content.
For this reason, such functions should be simple, with minimal external dependencies or
with their import statements inside the function body.
This decreases the odds of using two functions with identical local code (and, therefore, identical identifiers)
performing different calculations.



We consider that every value is generated by a process, starting from an `empty` `hdict`.
The process is a sequence of
transformation steps done through the operator `>>`, which symbolizes the ordering of the steps.
There are two types of steps:

* **value insertion** - represented by dict-like objects
* **function application** - represented by ordinary Python functions

Functions, `hdict`s, and values have a deterministic UUID
(called _hosh_ - **o**perable **h**a**sh**). 
Identifiers (hoshes) for `hdict`s and values are predictable through the
magic available [here](https://pypi.org/project/garoupa).
An `hdict` is completely defined by its key-value pairs so that
it can be converted from/to a built-in `dict`.

Creating an `hdict` is not different from creating an ordinary `dict`. Optionally it can be created through the `>>` operator
used after `empty` or `Ø` (usually AltGr+Shift+o in most keyboards).
The resulting `hdict` always contains two extra entries `id` and `ids`:
![img.png](https://raw.githubusercontent.com/davips/hdict/main/examples/img.png)

Function application is done in the same way. The parameter names define the input fields, while the keys in the
returned `dict` define the output fields:
![img_1.png](https://raw.githubusercontent.com/davips/hdict/main/examples/img_1.png)

After evaluated, the value will not be calculated again:
![img_2.png](https://raw.githubusercontent.com/davips/hdict/main/examples/img_2.png)

Functions can accept parameters:
![img_3.png](https://raw.githubusercontent.com/davips/hdict/main/examples/img_3.png)


## Installation
### ...as a standalone lib
```bash
# Set up a virtualenv. 
python3 -m venv venv
source venv/bin/activate

# Install from PyPI...
pip install --upgrade pip
pip install -U hdict
pip install -U hdict[full]  # use the flag 'full' for extra functionality (recommended)

# ...or, install from updated source code.
pip install git+https://github.com/davips/hdict
```

### ...from source
```bash
git clone https://github.com/davips/hdict
cd hdict
poetry install
poetry install -E full  # use the flag 'full' for extra functionality (recommended)
```

## Examples

<<intro>>

<<levelid>>

<<merging>>

<<apply>>

<<sampling>>

<<compositionofsets>>

<persistence>

## Concept


## Development
### Licensing
The initial license choosen is GPL. Please contact the developer for other licensing needs.

### Versioning
The version is a has a meaningful calendar component (`minor=yymmdd`), but it is still compatible with semantic versioning.
For instance, the version `0.230215.1` means `major=0`, `minor=230215`, `micro/patch=1`.
Notes:
 * While `major=0`, some compatibility breaking changes may occur.
 * From `major=1` onwards, compatibility breaking changes increment it, and update the minor version to reflect the release date.
 * New (non breaking) features update only the minor version to reflect the release date.
 * Bug fixes (including breaking ones) increment only the micro version.

### Contributing
#### Collaboration
Research

#### Donation
Expenses:
  * Programming hours
  * Support
  * Custom features
  * Domain name yearly costs

### Acknowledgement
This work was based on a previous research supported by Fapesp under supervision of
Prof. André C. P. L. F. de Carvalho at CEPID-CeMEAI (Grants 2013/07375-0 – 2019/01735-0)
until 2021-03-31.

We would like to thank the providers of free tools that make this project feasible:
  * github for hosting the code repository freely
  * Oracle for hosting the website freely
  * Developers of Mint, XFCE, and GNU/Linux for the operating system
  * JetBrains for Intellij IDEA Community Edition
  * Developers of Python packages listed in our project.toml
